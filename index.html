<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lost & Found ‚Äî Stasiun Cirebon</title>
  <style>
    :root {
      --yellow:#FFC823; --yellow2:#FFB31A;
      --dark:#222326; --card:#ffffff;
      --muted:#6b7280; --line:#e5e7eb;
      --ok:#16a34a; --warn:#f59e0b; --info:#3b82f6; --danger:#ef4444;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,var(--yellow) 0%, var(--yellow2) 22%, #f7f7f7 22%);
      color:#111827;
    }
    .wrap{max-width:1180px; margin:0 auto; padding:26px 18px 42px;}
    header{display:flex; gap:14px; align-items:center; justify-content:space-between; padding:10px 0 18px;}
    .brand h1{margin:0; font-size:28px;}
    .brand p{margin:4px 0 0; color:#1f2937}
    .pill{border:2px solid #111827; background:rgba(255,255,255,.35); padding:10px 12px; border-radius:999px; font-weight:650;}
    .grid{display:grid; grid-template-columns: 320px 1fr; gap:18px;}
    @media (max-width: 980px) { .grid{grid-template-columns:1fr;} }
    .panel{background:var(--dark); border-radius:var(--radius); padding:16px; color:white; box-shadow:0 10px 30px rgba(0,0,0,.15);}
    .menu button{width:100%; text-align:left; border:0; cursor:pointer; margin:8px 0; padding:12px 12px; border-radius:14px; background:rgba(255,255,255,.10); color:#fff; font-weight:800;}
    .menu button.active{background:rgba(255,255,255,.22);}
    .menu .hint{color:rgba(255,255,255,.75); font-size:13px; line-height:1.35; margin-top:10px;}
    .content{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.10);}
    .kpis{display:grid; grid-template-columns: repeat(4, 1fr); gap:12px; margin-bottom:14px;}
    @media (max-width: 980px) { .kpis{grid-template-columns: repeat(2,1fr);} }
    .kpi{border:1px solid var(--line); border-radius:16px; padding:12px;}
    .kpi .label{color:var(--muted); font-size:13px; font-weight:750;}
    .kpi .val{font-size:26px; font-weight:900; margin-top:4px;}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    @media (max-width: 760px) { .row{grid-template-columns:1fr;} }
    label{display:block; font-weight:800; margin:10px 0 6px;}
    input, select, textarea{width:100%; padding:12px 12px; border-radius:14px; border:1px solid var(--line); font-size:15px;}
    textarea{min-height:98px; resize:vertical;}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .btn{border:0; border-radius:14px; padding:12px 14px; font-weight:900; cursor:pointer;}
    .btn.primary{background:var(--dark); color:white;}
    .btn.soft{background:#f3f4f6; color:#111827; border:1px solid var(--line);}
    .btn.danger{background:var(--danger); color:white;}
    .note{color:var(--muted); font-size:13px; margin-top:10px; line-height:1.4;}
    .success{border:1px solid #bbf7d0; background:#ecfdf5; color:#065f46; padding:12px; border-radius:16px; font-weight:800;}
    .warnbox{border:1px solid #fde68a; background:#fffbeb; color:#92400e; padding:12px; border-radius:16px; font-weight:800;}
    .table{width:100%; border-collapse:separate; border-spacing:0; border:1px solid var(--line); border-radius:16px; overflow:hidden;}
    .table th, .table td{padding:10px 10px; border-bottom:1px solid var(--line); font-size:14px; text-align:left;}
    .table th{background:#f9fafb; font-weight:950;}
    .table tr:last-child td{border-bottom:0;}
    .tag{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-weight:950; font-size:12px;}
    .tag.info{background:#eff6ff; color:#1d4ed8;}
    .tag.warn{background:#fffbeb; color:#92400e;}
    .tag.ok{background:#ecfdf5; color:#065f46;}
    .tag.danger{background:#fef2f2; color:#991b1b;}
    .split{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:10px;}
    .small{font-size:13px; color:var(--muted);}
    .inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .lock{border:1px dashed var(--line); padding:10px; border-radius:16px; background:#fafafa;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Lost &amp; Found ‚Äî Stasiun Cirebon</h1>
        <p>Scan QR ‚Üí buat laporan / cek status barang tertinggal.</p>
      </div>
      <div class="pill">Dashboard Stasiun Cirebon</div>
    </header>

    <div class="grid">
      <aside class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div>
            <div style="font-weight:950;font-size:18px;">Menu</div>
            <div style="color:rgba(255,255,255,.75);font-size:13px;">Pilih layanan</div>
          </div>
          <div style="font-weight:950;background:rgba(255,255,255,.12);padding:8px 10px;border-radius:999px;">üòä</div>
        </div>

        <div class="menu" id="menu">
          <button data-view="report" class="active">üßæ Buat Laporan</button>
          <button data-view="status">üîé Cek Status</button>
          <button data-view="admin">üõ†Ô∏è Mode Petugas</button>
          <div class="hint">Tips: tulis ciri barang sedetail mungkin (warna, merek, stiker, isi tas, dsb).</div>
        </div>

        <div style="margin-top:12px; color:rgba(255,255,255,.85); font-size:12px; line-height:1.35;">
          <div><b>Lokasi layanan:</b> Customer Service / Pos Keamanan</div>
          <div>Kontak: WA <span class="wa-block">0811-2223-3121</span> ‚Ä¢ Email: lostfoundcn@gmail.com</div>
        </div>
      </aside>

      <main class="content">
        <div id="view"></div>
      </main>
    </div>
  </div>

<script>
  const ADMIN_CODE = "CIREBON3 ADM";

  const KEY = "lf_reports_v1";
  function getReports(){ try{ return JSON.parse(localStorage.getItem(KEY) || "[]"); }catch(e){ return []; } }
  function saveReports(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
  function makeId(){ const d=new Date(); const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,"0"); const da=String(d.getDate()).padStart(2,"0"); const rnd=Math.floor(1000+Math.random()*9000); return `CBO-${y}${m}${da}-${rnd}`; }
  function fmt(dt){ const d=new Date(dt); const dd=String(d.getDate()).padStart(2,"0"); const mm=String(d.getMonth()+1).padStart(2,"0"); const yy=d.getFullYear(); const hh=String(d.getHours()).padStart(2,"0"); const mi=String(d.getMinutes()).padStart(2,"0"); return `${dd}/${mm}/${yy} ${hh}:${mi}`; }
  function tag(status){ const s=(status||"Diterima"); if(s==="Diterima") return `<span class="tag info">üì© ${s}</span>`; if(s==="Diproses") return `<span class="tag warn">‚è≥ ${s}</span>`; if(s==="Ditemukan") return `<span class="tag ok">‚úÖ ${s}</span>`; if(s==="Selesai") return `<span class="tag ok">üéâ ${s}</span>`; return `<span class="tag danger">‚ö†Ô∏è ${s}</span>`; }
  function stats(list){ const today=new Date(); today.setHours(0,0,0,0); const todayCount=list.filter(r=>new Date(r.createdAt)>=today).length; const processing=list.filter(r=>r.status==="Diproses").length; const found=list.filter(r=>r.status==="Ditemukan").length; const done=list.filter(r=>r.status==="Selesai").length; return {todayCount,processing,found,done}; }

  const view=document.getElementById("view");

  function renderReport(){ view.innerHTML=`
    <div class="split">
      <div>
        <div style="font-weight:950;font-size:20px;">üßæ Buat Laporan Barang Tertinggal</div>
        <div class="small">Isi form ini (¬± 1 menit). Setelah submit, kamu akan dapat <b>ID laporan</b>.</div>
      </div>
    </div>

    <div class="row">
      <div><label>Nama</label><input id="name" placeholder="Contoh: Anindita" /></div>
      <div><label>No. HP / WhatsApp</label><input id="phone" placeholder="Contoh: 08xxxxxxxxxx" /></div>
    </div>

    <div class="row">
      <div><label>Tanggal & Jam kejadian</label><input id="when" type="datetime-local" /></div>
      <div>
        <label>Lokasi perkiraan</label>
        <select id="place">
          <option>Ruang tunggu</option><option>Peron</option><option>Loket / Ticketing</option><option>Gate</option>
          <option>Toilet</option><option>Mushola</option><option>Area parkir / drop-off</option><option>Di kereta</option><option>Lainnya</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Jenis barang</label>
        <select id="type">
          <option>HP</option><option>Dompet</option><option>Tas / Ransel</option><option>Dokumen (KTP/SIM/Paspor)</option>
          <option>Laptop</option><option>Koper</option><option>Powerbank / Charger</option><option>Lainnya</option>
        </select>
      </div>
      <div><label>Nomor KA (jika ada)</label><input id="train" placeholder="Contoh: KA Argo Cheribon / 123" /></div>
    </div>

    <label>Ciri-ciri barang (merek/warna/stiker/isi)</label>
    <textarea id="desc" placeholder="Contoh: iPhone hitam, casing transparan, ada stiker bulat..."></textarea>

    <div class="actions">
      <button class="btn primary" id="submit">Kirim Laporan</button>
      <button class="btn soft" id="clear">Reset</button>
    </div>
    <div class="note">Dengan mengirim laporan, data dipakai untuk proses penanganan Lost &amp; Found.</div>
    <div id="msg" style="margin-top:12px;"></div>
  `;

    document.getElementById("clear").onclick=()=>renderReport();
    document.getElementById("submit").onclick=()=>{
      const name=document.getElementById("name").value.trim();
      const phone=document.getElementById("phone").value.trim();
      const when=document.getElementById("when").value;
      const place=document.getElementById("place").value;
      const type=document.getElementById("type").value;
      const train=document.getElementById("train").value.trim();
      const desc=document.getElementById("desc").value.trim();

      if(!name||!phone||!when||!desc){
        document.getElementById("msg").innerHTML=`<div class="warnbox">Mohon isi: Nama, No HP/WA, Tanggal &amp; Jam, dan Ciri-ciri barang ya üòä</div>`;
        return;
      }

      const id=makeId();
      const list=getReports();
      list.unshift({id,name,phone,when,place,type,train,desc,status:"Diterima",notes:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});
      saveReports(list);

      document.getElementById("msg").innerHTML=`
        <div class="success">
          Laporan terkirim! üôå<br/>
          <div style="margin-top:6px;">ID Laporan: <b style="font-size:18px;">${id}</b></div>
          <div style="margin-top:6px;">Simpan ID ini untuk cek status. Jika butuh bantuan cepat, silakan ke Customer Service.</div>
        </div>`;
    };
  }

  function renderStatus(){ view.innerHTML=`
    <div class="split">
      <div>
        <div style="font-weight:950;font-size:20px;">üîé Cek Status Laporan</div>
        <div class="small">Masukkan ID laporan (contoh: CBO-YYYYMMDD-XXXX)</div>
      </div>
    </div>

    <div class="row">
      <div><label>ID Laporan</label><input id="qid" placeholder="CBO-YYYYMMDD-XXXX" /></div>
      <div style="display:flex;align-items:flex-end;"><button class="btn primary" id="qbtn" style="width:100%;">Cek</button></div>
    </div>

    <div id="qres" style="margin-top:14px;"></div>
  `;

    document.getElementById("qbtn").onclick=()=>{
      const id=document.getElementById("qid").value.trim();
      const list=getReports();
      const r=list.find(x=>x.id===id);
      if(!r){ document.getElementById("qres").innerHTML=`<div class="warnbox">Belum ketemu ID itu. Cek lagi penulisannya ya üòä</div>`; return; }
      document.getElementById("qres").innerHTML=`
        <div style="border:1px solid var(--line); border-radius:16px; padding:12px;">
          <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div><div style="font-weight:950; font-size:16px;">ID: ${r.id}</div><div class="small">Terakhir update: ${fmt(r.updatedAt)}</div></div>
            <div>${tag(r.status)}</div>
          </div>
          <hr style="border:0;border-top:1px solid var(--line); margin:12px 0;" />
          <div class="row">
            <div><div class="small">Jenis</div><div style="font-weight:850;">${r.type}</div></div>
            <div><div class="small">Lokasi</div><div style="font-weight:850;">${r.place}</div></div>
          </div>
          <div style="margin-top:10px;"><div class="small">Ciri-ciri</div><div style="font-weight:750;">${r.desc}</div></div>
          <div style="margin-top:10px;"><div class="small">Catatan petugas</div><div style="font-weight:750;">${r.notes||"‚Äî"}</div></div>
          <div class="note">Jika status <b>Ditemukan</b>, silakan datang ke Customer Service dengan identitas yang sesuai.</div>
        </div>`;
    };
  }

  function renderAdmin(){ 
    const LOCK_KEY="lf_admin_unlocked";
    const unlocked=sessionStorage.getItem(LOCK_KEY)==="1";
    if(!unlocked){
      view.innerHTML=`
        <div style="font-weight:950;font-size:20px;">üõ†Ô∏è Mode Petugas</div>
        <div class="small">Masukkan kode akses untuk membuka dashboard petugas.</div>
        <div class="lock" style="margin-top:12px;">
          <label>Kode akses</label>
          <div class="inline">
            <input id="code" placeholder="Masukkan kode akses" style="max-width:320px;" />
            <button class="btn primary" id="unlock">Buka</button>
          </div>
          <div class="note">Kode akses hanya untuk petugas.</div>
        </div>
        <div id="amsg" style="margin-top:12px;"></div>
      `;
      document.getElementById("unlock").onclick=()=>{
        const c=(document.getElementById("code").value||"").trim().toUpperCase();
        if(c===ADMIN_CODE){
          sessionStorage.setItem(LOCK_KEY,"1"); renderAdmin();
        } else {
          document.getElementById("amsg").innerHTML=`<div class="warnbox">Kode belum sesuai üòä</div>`;
        }
      };
      return;
    }

    const list=getReports();
    const s=stats(list);
    view.innerHTML=`
      <div class="split">
        <div>
          <div style="font-weight:950;font-size:20px;">üìä Dashboard Petugas ‚Äî Lost &amp; Found</div>
          <div class="small">Kelola status laporan (data tersimpan di browser / offline).</div>
        </div>
        <div class="inline">
          <button class="btn soft" id="export">Export CSV</button>
          <button class="btn danger" id="lock">Kunci</button>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="label">Laporan hari ini</div><div class="val">${s.todayCount}</div></div>
        <div class="kpi"><div class="label">Diproses</div><div class="val">${s.processing}</div></div>
        <div class="kpi"><div class="label">Ditemukan</div><div class="val">${s.found}</div></div>
        <div class="kpi"><div class="label">Selesai</div><div class="val">${s.done}</div></div>
      </div>

      <div class="row">
        <div>
          <label>Filter status</label>
          <select id="filter">
            <option value="">Semua</option>
            <option>Diterima</option><option>Diproses</option><option>Ditemukan</option><option>Selesai</option>
          </select>
        </div>
        <div>
          <label>Cari ID / Nama / HP</label>
          <input id="search" placeholder="contoh: CBO- / nama / 08xx" />
        </div>
      </div>

      <div style="margin-top:12px; overflow:auto;">
        <table class="table">
          <thead><tr>
            <th>ID</th><th>Dibuat</th><th>Pelapor</th><th>Jenis</th><th>Lokasi</th><th>Status</th><th>Update</th>
          </tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="note">Klik tombol "Update" untuk mengubah status &amp; catatan.</div>
    `;

    const tbody=document.getElementById("tbody");
    const renderRows=()=>{
      const f=document.getElementById("filter").value;
      const q=(document.getElementById("search").value||"").toLowerCase();
      const rows=list.filter(r=>{
        const okF=!f||r.status===f;
        const okQ=!q||(r.id+r.name+r.phone).toLowerCase().includes(q);
        return okF&&okQ;
      });
      tbody.innerHTML=rows.map(r=>`
        <tr>
          <td><b>${r.id}</b></td>
          <td>${fmt(r.createdAt)}</td>
          <td>${r.name}<div class="small">${r.phone}</div></td>
          <td>${r.type}</td>
          <td>${r.place}</td>
          <td>${tag(r.status)}</td>
          <td><button class="btn soft" data-id="${r.id}">Update</button></td>
        </tr>
      `).join("") || `<tr><td colspan="7" class="small">Belum ada laporan.</td></tr>`;

      tbody.querySelectorAll("button[data-id]").forEach(btn=>{
        btn.onclick=()=>openUpdate(btn.getAttribute("data-id"));
      });
    };

    document.getElementById("filter").onchange=renderRows;
    document.getElementById("search").oninput=renderRows;
    renderRows();

    document.getElementById("lock").onclick=()=>{ sessionStorage.removeItem("lf_admin_unlocked"); renderAdmin(); };

    document.getElementById("export").onclick=()=>{
      const headers=["id","createdAt","name","phone","when","place","type","train","desc","status","notes","updatedAt"];
      const csv=[headers.join(",")].concat(list.map(r=>headers.map(h=>JSON.stringify(r[h]??"")).join(","))).join("\n");
      const blob=new Blob([csv],{type:"text/csv"});
      const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="lostfound_reports.csv"; a.click();
    };

    function openUpdate(id){
      const r=getReports().find(x=>x.id===id); if(!r) return;
      const html=`
        <div style="position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:18px;z-index:9999;">
          <div style="width:min(720px,100%);background:white;border-radius:18px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);">
            <div class="split" style="margin-bottom:8px;">
              <div><div style="font-weight:950;font-size:18px;">Update Laporan</div><div class="small">ID: <b>${r.id}</b></div></div>
              <button class="btn soft" id="close">Tutup</button>
            </div>

            <div class="row">
              <div>
                <label>Status</label>
                <select id="ustatus">
                  <option ${r.status==="Diterima"?"selected":""}>Diterima</option>
                  <option ${r.status==="Diproses"?"selected":""}>Diproses</option>
                  <option ${r.status==="Ditemukan"?"selected":""}>Ditemukan</option>
                  <option ${r.status==="Selesai"?"selected":""}>Selesai</option>
                </select>
              </div>
              <div>
                <label>Catatan petugas</label>
                <input id="unotes" placeholder="contoh: barang ada di pos keamanan..." value="${(r.notes||"").replaceAll('"','&quot;')}" />
              </div>
            </div>

            <label>Ringkasan barang</label>
            <div style="border:1px solid var(--line);border-radius:16px;padding:12px;background:#fafafa;">
              <div class="row">
                <div><div class="small">Jenis</div><div style="font-weight:850;">${r.type}</div></div>
                <div><div class="small">Lokasi</div><div style="font-weight:850;">${r.place}</div></div>
              </div>
              <div style="margin-top:10px;"><div class="small">Ciri-ciri</div><div style="font-weight:750;">${r.desc}</div></div>
              <div class="small" style="margin-top:10px;">Pelapor: <b>${r.name}</b> ‚Ä¢ ${r.phone}</div>
            </div>

            <div class="actions">
              <button class="btn primary" id="save">Simpan</button>
              <button class="btn danger" id="del">Hapus</button>
            </div>
          </div>
        </div>`;
      const wrap=document.createElement("div"); wrap.innerHTML=html; document.body.appendChild(wrap);
      wrap.querySelector("#close").onclick=()=>wrap.remove();
      wrap.querySelector("#save").onclick=()=>{
        const status=wrap.querySelector("#ustatus").value;
        const notes=wrap.querySelector("#unotes").value.trim();
        const all=getReports();
        const idx=all.findIndex(x=>x.id===id);
        if(idx>=0){ all[idx].status=status; all[idx].notes=notes; all[idx].updatedAt=new Date().toISOString(); saveReports(all); }
        wrap.remove(); renderAdmin();
      };
      wrap.querySelector("#del").onclick=()=>{
        const all=getReports().filter(x=>x.id!==id); saveReports(all);
        wrap.remove(); renderAdmin();
      };
    }
  }

  function setActive(viewName){ document.querySelectorAll("#menu button").forEach(b=>b.classList.toggle("active", b.dataset.view===viewName)); }
  function navigate(viewName){ setActive(viewName); if(viewName==="report") renderReport(); if(viewName==="status") renderStatus(); if(viewName==="admin") renderAdmin(); }
  document.getElementById("menu").addEventListener("click",(e)=>{ const btn=e.target.closest("button[data-view]"); if(!btn) return; navigate(btn.dataset.view); });
  navigate("report");
</script>
</body>
</html>
